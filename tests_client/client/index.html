<!DOCTYPE html>
<html>
<head>
   <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.js"></script>
   <script type="text/javascript">
      var sock = null;
      var ellog = null;

      window.onload = function() {

         var wsuri;
         ellog = document.getElementById('log');

         wsuri = "wss://localhost:9000";

         if ("WebSocket" in window) {
            sock = new WebSocket(wsuri);
         } else if ("MozWebSocket" in window) {
            sock = new MozWebSocket(wsuri);
         } else {
            log("Browser does not support WebSocket!");
            window.location = "http://autobahn.ws/unsupportedbrowser";
         }

         if (sock) {
            sock.onopen = function() {
               log("Connected to " + wsuri);
            }

            sock.onclose = function(e) {
               log("Connection closed (wasClean = " + e.wasClean + ", code = " + e.code + ", reason = '" + e.reason + "')");
            }

            sock.onmessage = function(e) {
               log("Got Server Message: " + e.data);
            }
         }
      };

      function log(m) {
         document.getElementById('log').innerHTML += m + '\n';
      };

      function send(cmd) {
         if (sock) {
            var cmdString = JSON.stringify(cmd);
            sock.send(cmdString);
            log("Sent: " + cmdString);
         } else {
            log("Not connected.");
         }
      }

      function open_cmd() {
         var filepath = document.getElementById('filepath').value;
         cmd = {
            name: 'open',
            data: {filepath: filepath}
         };

         send(cmd)
      };


      function echo() {
         var msg = document.getElementById('message').value;
         cmd = {
            name: 'echo',
            data: {message: msg}
         };

         send(cmd)
      };

      function pickFileOrDirectory() {
         cmd = {name: 'pickFileOrDirectory'};
         send(cmd)
      };

      function getVersion() {
         cmd = {name: 'version'};
         send(cmd)
      };

      function pickFileOrDirectories() {
         cmd = {name: 'pickFileOrDirectories'};
         send(cmd)
      };

      function sgtkCommand() {
         var command = document.getElementById('sgtk_command').value;
         var args = JSON.parse(document.getElementById('sgtk_args').value || "[]");
         var pipelineConfigPath = document.getElementById('sgtk_pipelineConfigPath').value;
         cmd = {
            name: 'executeToolkitCommand',
            data: {
               command: command,
               args: args,
               pipelineConfigPath: pipelineConfigPath
            }
         };

         send(cmd)
      };
   </script>
</head>

<body>
<h1>Shotgun Secure WebSocket Client Test</h1>
<noscript>You must enable JavaScript</noscript>

<div>
   <button onclick='echo();'>Send Message</button>
   <input id="message" type="text" size="50" value="Hello, world!">
</div>
<div>
   <button onclick='open_cmd();'>Open file</button>
   <input id="filepath" type="text" size="50" value="/Users/rivestm/tmp.txt">
</div>
<div>
   <button onclick='getVersion();'>Get Server API Version</button>
</div>
<div>
   <button onclick='pickFileOrDirectory();'>Pick File Or Directory</button>
</div>
<div>
   <button onclick='pickFileOrDirectories();'>Pick File Or Directories</button>
</div>
<div>
   <button onclick='sgtkCommand();'>Execute Toolkit Command</button>
   <input id="sgtk_pipelineConfigPath" type="text" size="50" value="/Users/rivestm/shotgun/toolkit/config24" placeholder="Pipeline Configuration">
   <input id="sgtk_command" type="text" size="50" maxlength="50" value="shotgun_cache_actions" placeholder="Toolkit Command">
   <input id="sgtk_args" type="text" size="50" maxlength="50" value='' placeholder='Argument list as JSON list (ex: ["myarg"]'>
</div>

<pre id="log" style="height: 20em; overflow-y: scroll; background-color: #faa;"></pre>
</body>
</html>
